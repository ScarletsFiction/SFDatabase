{"version":3,"sources":["_head.js","IDB.js","WebSQL.js","SQL.js","_foot.js"],"names":["SFDatabase","databaseName","options","onConnected","scope","this","db","pending","initialized","debug","initFinish","setTimeout","resumePending","pendingTimer","clearTimeout","length","i","splice","destroyObject","obj","Array","objKeys","Object","keys","preprocessTable","preprocessData","tableName","mode","object","found","isNode","process","execPath","onStructureInitialize","checkStructure","callback","table","databaseStructure","queued","reduceQueue","console","error","createTable","IDBStructure","initError","IDBWhere","regexEscape","IDBLimit","prepareQuery","data","rules","ORCondition","currentCondition","rules_","matches","match","check","toLowerCase","rule","operationCondition","undefined","indexOf","likeCode","regexed","rule_","a","temp","slice","replace","push","exist","RegExp","join","query","processed","startFrom","limit","objectStore","where","LIMIT","ORDER","cursor","index","openCursor","key","columns","successCallback","errorCallback","objectStoreNames","contains","text","columns_","createObjectStore","keyPath","autoIncrement","col","createIndex","unique","e","insert","duplicated","objectStoreRequest","getObjectStore","add","onerror","onsuccess","ev","target","result","get","select","event","value","constructor","String","continue","operation","code","delete","update","drop","closeDatabase","deleteObjectStore","initializeTable","close","window","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","IDBTransaction","webkitIDBTransaction","msIDBTransaction","IDBKeyRange","webkitIDBKeyRange","msIDBKeyRange","storage","open","idbVersion","onupgradeneeded","versionchange","action","transaction","WebSQLStructure","validateText","makeWhere","comparator","children","wheres","objectData","defaultConditional","specialList","isNaN","msg","type","name","concat","likes","test","split","haveRelation","childs","stack","order","toUpperCase","where_","SQLQuery","select_","rows","objectName","objectName_","object_","JSON","parse","stringify","polyfill","message","SQLQueryBuilder","values","tx","executeSql","res","readOnly","rowsAffected","disablePlugin","sqlitePlugin","openDatabase","location","error_","websql","warn","module","exports"],"mappings":"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","file":"SFDatabase.min.js","sourcesContent":["/*\r\n\tScarletsFiction Database Library\r\n\tA simple database library for browser and nodejs\r\n\thttps://github.com/ScarletsFiction/SFDatabase-js\r\n\t\r\n\tMake sure you include this header on this script\r\n*/\r\n\r\n'use strict';\r\n\r\n// Ext-AlaSQL.js are required for browser only if the browser didn't support WebSQL\r\nfunction SFDatabase(databaseName, options, onConnected){\r\n\tvar scope = this;\r\n\tscope.db = null;\r\n\tscope.pending = [];\r\n\tscope.initialized = false;\r\n\tif(!options)\r\n\t\toptions = {debug:false};\r\n\r\n\tvar initFinish = function(){\r\n\t\tif(scope.initialized) return;\r\n\t\tscope.initialized = true;\r\n\r\n\t\tif(onConnected){\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tif(!onConnected(resumePending))\r\n\t\t\t\t\tresumePending();\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\telse resumePending();\r\n\t}\r\n\r\n\tvar pendingTimer = -1;\r\n\tvar resumePending = function(){\r\n\t\tif(!scope.db){\r\n\t\t\tclearTimeout(pendingTimer);\r\n\t\t\tpendingTimer = setTimeout(resumePending, 1000);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!scope.pending.length) return;\r\n\t\tfor (var i = 0; i < scope.pending.length; i++) {\r\n\t\t\tscope.pending[i]();\r\n\t\t}\r\n\t\tscope.pending.splice(0);\r\n\t}\r\n\r\n\tvar destroyObject = function(obj){\r\n\t\tif(!obj || typeof obj !== 'object') return;\r\n\t\tif(obj instanceof Array)\r\n\t\t\tobj.splice(0);\r\n\t\telse {\r\n\t\t\tvar objKeys = Object.keys(obj);\r\n\t\t\tfor (var i = 0; i < objKeys.length; i++) {\r\n\t\t\t\tdelete obj[objKeys[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t\tobj = null;\r\n\t}\r\n\r\n\tscope.preprocessTable = {}; // {tableName:{columnName:{set:function, get:function}}}}\r\n\tvar preprocessData = function(tableName, mode, object){\r\n\t\tvar found = false;\r\n\t\tif(!scope.preprocessTable[tableName]) return found;\r\n\r\n\t\tvar keys = Object.keys(scope.preprocessTable[tableName]);\r\n\t\tfor (var i = 0; i < keys.length; i++) {\r\n\t\t\tif(!object[keys[i]] || !scope.preprocessTable[tableName][keys[i]][mode])\r\n\t\t\t\tcontinue;\r\n\t\t\tobject[keys[i]] = scope.preprocessTable[tableName][keys[i]][mode](object[keys[i]]);\r\n\t\t\tfound = true;\r\n\t\t}\r\n\t\treturn found;\r\n\t}\r\n\r\n\tvar isNode = typeof process !== 'undefined' && process.execPath;\r\n\tif(!isNode){\r\n\t\tvar onStructureInitialize = null;\r\n\t\tvar checkStructure = function(callback){\r\n\t\t\tvar table = Object.keys(options.databaseStructure);\r\n\r\n\t\t\tvar queued = table.length;\r\n\t\t\tvar reduceQueue = function(){\r\n\t\t\t\tqueued--;\r\n\t\t\t\tif(queued === 0){\r\n\t\t\t\t\tif(!callback) initFinish(scope);\r\n\t\t\t\t\telse callback();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tif(queued > 1)\r\n\t\t\t\t\tconsole.error(\"Failed to initialize database structure\");\r\n\t\t\t}, 5000);\r\n\r\n\t\t\tfor (var i = 0; i < table.length; i++) {\r\n\t\t\t\tscope.createTable(table[i], options.databaseStructure[table[i]], reduceQueue);\r\n\t\t\t}\r\n\r\n\t\t\tif(onStructureInitialize){\r\n\t\t\t\tonStructureInitialize();\r\n\t\t\t\tonStructureInitialize = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// Load all query builder from here","if(!isNode && !options.websql){\r\n\tIDBStructure(function(){\r\n\t\t// Fallback to WebSQL\r\n\t\tconsole.warn(\"Fallback to WebSQL\");\r\n\t\tWebSQLStructure();\r\n\t});\r\n}\r\n\r\nfunction IDBStructure(initError){\r\n\tIDBQueryBuilder();\r\n\r\n\tif(!window.indexedDB)\r\n  \t\twindow.indexedDB = window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;\r\n\tif(!window.IDBTransaction)\r\n\t\twindow.IDBTransaction = window.webkitIDBTransaction || window.msIDBTransaction;\r\n\tif(!window.IDBKeyRange)\r\n\t\twindow.IDBKeyRange = window.webkitIDBKeyRange || window.msIDBKeyRange;\r\n\r\n\tif(!window.indexedDB || !window.IDBTransaction || !window.IDBKeyRange){\r\n\t\tif(initError) initError();\r\n\t\treturn;\r\n\t}\r\n\r\n\tscope.storage = 'indexeddb';\r\n\tscope.db = window.indexedDB.open(databaseName, options.idbVersion || 1);\r\n\tscope.db.onerror = initError;\r\n\r\n\tscope.db.onupgradeneeded = scope.db.versionchange = function(ev){\r\n\t\tif(scope.db.result)\r\n\t\t\tscope.db = scope.db.result;\r\n\r\n\t\tcheckStructure(function(){});\r\n\t};\r\n\r\n\tscope.db.onsuccess = function(ev){\r\n\t\tif(scope.db.result)\r\n\t\t\tscope.db = scope.db.result;\r\n\r\n\t\tcheckStructure(function(){\r\n\t\t\tinitFinish(scope);\r\n\t\t});\r\n\t};\r\n\r\n\t//action = readwrite, readonly\r\n\tscope.getObjectStore = function(tableName, action, errorCallback){\r\n  \t\tvar transaction = scope.db.transaction(tableName, action);\r\n  \t\ttransaction.onerror = errorCallback || console.error;\r\n  \t\treturn transaction.objectStore(tableName);\r\n\t}\r\n}","if(!isNode && options.websql === undefined) options.websql = true;\r\nif(options.websql){\r\n\tWebSQLStructure(function(){\r\n\t\t// Fallback to IndexedDB\r\n\t\tconsole.warn(\"Fallback to IndexedDB\");\r\n\t\tIDBStructure();\r\n\t});\r\n}\r\n\r\nfunction WebSQLStructure(initError){\r\n\tSQLQueryBuilder();\r\n\r\n\tscope.SQLQuery = function(query, values, successCallback, errorCallback){\r\n\t\tif(options.debug) options.debug(query, values);\r\n\r\n\t\tscope.db.transaction(function(tx){\r\n\t\t\ttx.executeSql(query, values, function(tx, res){\r\n\t\t\t\tdestroyObject(values);\r\n\t            values = query = null;\r\n\r\n\t\t\t\tif(successCallback){\r\n\t\t\t\t\tvar readOnly = res && res.rows ? res.rows : res; // SQLResultSetRowList is immutable\r\n\t\t\t\t\tif(res && res.rowsAffected && !readOnly.length){\r\n\t\t\t\t\t\tsuccessCallback(res.rowsAffected);\r\n\t\t\t\t\t\treadOnly = null;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(readOnly.length){\r\n\t\t\t\t\t\tvar result = {length:readOnly.length};\r\n\t\t\t\t\t\tfor (var i = 0; i < readOnly.length; i++) {\r\n\t\t\t\t\t\t\tresult[i] = readOnly[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treadOnly = null;\r\n\t\t\t\t\t\tsuccessCallback(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse successCallback([]);\r\n\t            }\r\n\t\t\t}, function(tx, error){\r\n\t\t\t\tvar msg = 'Database Error: ' + error.message;\r\n\t\t\t\tdestroyObject(values);\r\n\t            values = query = null;\r\n\r\n\t\t\t\tif(errorCallback) errorCallback(msg);\r\n\t\t\t\telse console.error(msg);\r\n\t\t\t});\r\n\t\t}, function(error){\r\n\t\t\tvar msg = 'Database Transaction Error: ' + error.message;\r\n\t\t\tif(errorCallback) errorCallback(msg);\r\n\t\t\telse console.error(msg);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initializeTable(disablePlugin){\r\n\t\tif(!disablePlugin && window.sqlitePlugin){\r\n\t\t\tscope.db = window.sqlitePlugin.openDatabase({name: databaseName, location: 'default'}, checkStructure, function(){\r\n\t\t\t\tconsole.error_(\"Failed to initialize sqlitePlugin\");\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tinitializeTable(true);\r\n\t\t\t\t}, 500);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if(window.openDatabase){\r\n\t\t\tscope.db = window.openDatabase(databaseName, \"1.0\", databaseName, 1024);\r\n\t\t\tif(scope.db) setTimeout(checkStructure, 500);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tconsole.error('WebSQL is not supported on this browser');\r\n\t\t\tif(initError) initError();\r\n\t\t}\r\n\t}\r\n\r\n\tinitializeTable();\r\n}","function SQLQueryBuilder(){\r\n\t// structure must have `scope.SQLQuery`\r\n\r\n\tfunction validateText(text){\r\n\t\tvar matches = text.match(/[a-zA-Z0-9_\\.]+/i);\r\n\t\treturn '`'+matches[0]+'`';\r\n\t}\r\n\r\n\t//{('AND', 'OR'), 'ORDER':{columnName:'ASC', 'DESC'}, 'LIMIT':[startIndex, rowsLimit]}\r\n\r\n\t// ex: [\"AND\"=>[\"id\"=>12, \"OR\"=>[\"name#1\"=>\"myself\", \"name\"=>\"himself\"]], \"LIMIT\"=>1]\r\n\t\t// Select one where (id == 12 && (name == \"myself\" || name == \"himself\"))\r\n\tscope.makeWhere = function(object, comparator, children){\r\n\t\tif(!object) return ['', []];\r\n\t\tvar wheres = [];\r\n\r\n\t\tvar objectData = [];\r\n\t\tvar columns = Object.keys(object);\r\n\t\tvar defaultConditional = ' AND ';\r\n\t\tvar specialList = ['order', 'limit'];\r\n\r\n\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\tvar value = object[columns[i]];\r\n\r\n\t\t\tvar matches = columns[i].match(/([a-zA-Z0-9_\\.]+)(\\[(\\>\\=?|\\<\\=?|\\!|\\<\\>|\\>\\<|\\!?~)\\])?/);\r\n\t\t\tvar check = matches[1].toLowerCase();\r\n\t\t\tif(check==='and' || check==='or') continue;\r\n\t\t\tif(!children && specialList.indexOf(check)!==-1) continue;\r\n\r\n\t\t\tif(matches[3]){\r\n\t\t\t\tif((['>', '>=', '<', '<=']).indexOf(matches[3])!==-1)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(!isNaN(value))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twheres.push(matches[1] + ' ' + matches[3] + ' ?');\r\n\t\t\t\t\t\tobjectData.push(value);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvar msg = 'SQL where: value of ' + matches[1] + ' is non-numeric and can\\'t be accepted';\r\n\t\t\t\t\t\tconsole.error(msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(matches[3] === '!')\r\n\t\t\t\t{\r\n\t\t\t\t\tvar type = value===null || value===undefined ? false : value.constructor.name;\r\n\t\t\t\t\tif(!type)\r\n\t\t\t\t\t\twheres.push(matches[1] + ' IS NOT NULL');\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(type==='Array'){\r\n\t\t\t\t\t\t\tvar temp = [];\r\n\t\t\t\t\t\t\tfor (var a = 0; a < value.length; a++) {\r\n\t\t\t\t\t\t\t\ttemp.push('?');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twheres.push(matches[1] + ' NOT IN ('+ temp.join(', ') +')');\r\n\t\t\t\t\t\t\tobjectData = objectData.concat(value);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\telse if(type==='Number' || type==='Boolean' || type==='String'){\r\n\t\t\t\t\t\t\twheres.push(matches[1] + ' != ?');\r\n\t\t\t\t\t\t\tobjectData.push(value);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tconsole.error('SQL where: value ' + matches[1] + ' with type ' + type + ' can\\'t be accepted');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (matches[3] === '~' || matches[3] === '!~')\r\n\t\t\t\t{\r\n\t\t\t\t\tif(value.constructor !== Array){\r\n\t\t\t\t\t\tvalue = [value];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar likes = [];\r\n\t\t\t\t\tfor (var a = 0; a < value.length; a++) {\r\n\t\t\t\t\t\tlikes.push(matches[1] + (matches[3] === '!~' ? ' NOT' : '') + ' LIKE ?');\r\n\t\t\t\t\t\tif(value.indexOf('%') === -1) value[a] = '%'+value[a]+'%';\r\n\t\t\t\t\t\tobjectData.push(value[a]);\r\n\t\t\t\t\t}\r\n\r\n                    wheres.push('('+likes.join(' OR ')+')');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar type = value===null || value===undefined ? false : value.constructor.name;\r\n\t\t\t\tif(!type)\r\n\t\t\t\t\twheres.push(matches[1] + ' IS NULL');\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(type==='Array'){\r\n\t\t\t\t\t\tvar temp = [];\r\n\t\t\t\t\t\tfor (var a = 0; a < value.length; a++) {\r\n\t\t\t\t\t\t\ttemp.push('?');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twheres.push(matches[1] + ' IN ('+ temp.join(', ') +')');\r\n\t\t\t\t\t\tobjectData = objectData.concat(value);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse if(type==='Number' || type==='Boolean' || type==='String'){\r\n\t\t\t\t\t\twheres.push(matches[1] + ' = ?');\r\n\t\t\t\t\t\tobjectData.push(value);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tconsole.error('SQL where: value ' + matches[1] + ' with type ' + type + ' can\\'t be accepted');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tif(columns[i]==='ORDER'||columns[i]==='LIMIT')\r\n                continue;\r\n\r\n\t\t\tvar test = columns[i].split('AND');\r\n\t\t\tvar haveRelation = false;\r\n\t\t\tif(test.length === 2 && test[0] === ''){\r\n\t\t\t\tdefaultConditional = ' AND ';\r\n\t\t\t\thaveRelation = true;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttest = columns[i].split('OR');\r\n\t\t\t\tif(test.length === 2 && test[0] === ''){\r\n\t\t\t\t\tdefaultConditional = ' OR ';\r\n\t\t\t\t\thaveRelation = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(haveRelation){\r\n\t\t\t\tvar childs = scope.makeWhere(object[columns[i]], defaultConditional, true);\r\n\t\t\t\twheres.push('('+childs[0]+')');\r\n\t\t\t\tobjectData = objectData.concat(childs[1]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar options = '';\r\n\t\tif(object['ORDER']){\r\n\t\t\tvar columns = Object.keys(object['ORDER']);\r\n\t\t\tvar stack = [];\r\n\t\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\t\tvar order = object['ORDER'][columns[i]].toUpperCase();\r\n\t\t\t\tif(order !== 'ASC' && order !== 'DESC') continue;\r\n\t\t\t\tstack.push(validateText(columns[i]) + ' ' + order);\r\n\t\t\t}\r\n\t\t\toptions = options + ' ORDER BY ' + stack.join(', ');\r\n\t\t}\r\n\t\tif(object['LIMIT']){\r\n\t\t\tif(!isNaN(object['LIMIT'][0]) && !isNaN(object['LIMIT'][1])){\r\n\t\t\t\toptions = options + ' LIMIT ' + object['LIMIT'][1] + ' OFFSET ' + object['LIMIT'][0];\r\n\t\t\t}\r\n\t\t\telse if(!isNaN(object['LIMIT'])){\r\n\t\t\t\toptions = options + ' LIMIT '+ object['LIMIT'];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar where_ = '';\r\n\t\tif(wheres.length!==0){\r\n\t\t\tif(!children)\r\n\t\t\t\twhere_ = \" WHERE \";\r\n\t\t\twhere_ = where_ + wheres.join(comparator ? comparator : defaultConditional);\r\n\t\t}\r\n\r\n\t\treturn [where_ + options, objectData];\r\n\t}\r\n\r\n\tscope.createTable = function(tableName, columns, successCallback, errorCallback)\r\n\t{\r\n\t\tvar columns_ = Object.keys(columns);\r\n\t\tfor(var i = 0; i < columns_.length; i++){\r\n\t\t\tif(columns[columns_[i]].constructor.name === 'Array')\r\n\t\t\t\tcolumns_[i] = validateText(columns_[i]) + ' ' + columns[columns_[i]].join(' ').toUpperCase();\r\n\t\t\telse\r\n\t\t\t\tcolumns_[i] = validateText(columns_[i]) + ' ' + String(columns[columns_[i]]).toUpperCase();\r\n\t\t}\r\n\t\tvar query = 'CREATE TABLE IF NOT EXISTS '+validateText(tableName)+' ('+columns_.join(', ')+')';\r\n\r\n\t\tscope.SQLQuery(query, [], successCallback, errorCallback);\r\n\t}\r\n\r\n\t//Select separated by comma\r\n\tscope.select = function(tableName, select, where, successCallback, errorCallback){\r\n\t\tvar select_ = select;\r\n\t\t\r\n\t\tif(select !== '*'){\r\n\t\t\tif(select.constructor === String)\r\n\t\t\t\tselect_ = [select];\r\n\r\n\t\t\tfor(var i = 0; i < select_.length; i++){\r\n\t\t\t\tselect_[i] = validateText(select_[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse select_ = false;\r\n\t\t\r\n\t\tvar wheres = scope.makeWhere(where);\r\n\t\tvar query = \"SELECT \" + (select_?select_.join(', '):select) + \" FROM \" + validateText(tableName) + wheres[0];\r\n\r\n\t\tscope.SQLQuery(query, wheres[1], function(data){\r\n\t\t\tif(successCallback === void 0) return;\r\n\t\t\tif(data.length !== 0 && preprocessData(tableName, 'get', data[0])){\r\n\t\t\t\tfor (var i = 1; i < data.length; i++) {\r\n\t\t\t\t\tpreprocessData(tableName, 'get', data[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsuccessCallback(data);\r\n\t\t}, errorCallback);\r\n\t}\r\n\r\n\tscope.get = function(tableName, select, where, successCallback, errorCallback){\r\n\t\twhere.LIMIT = 1;\r\n\t\tscope.select(tableName, select, where, function(rows){\r\n\t\t\tif(rows.length === 0)\r\n\t\t\t\tsuccessCallback(null);\r\n\t\t\telse if(select.constructor === Array)\r\n\t\t\t\tsuccessCallback(rows[0]);\r\n\t\t\telse successCallback(rows[0][select]);\r\n\t\t}, errorCallback);\r\n\t}\r\n\r\n\tscope.delete = function(tableName, where, successCallback, errorCallback){\r\n\t\tif(where){\r\n\t\t\tvar wheres = scope.makeWhere(where);\r\n\t\t\tvar query = \"DELETE FROM \" + validateText(tableName) + wheres[0];\r\n\t\t\tscope.SQLQuery(query, wheres[1], successCallback, errorCallback);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar query = \"TRUNCATE TABLE \" + validateText(tableName);\r\n\t\t\tscope.SQLQuery(query, [], successCallback, function(msg){\r\n\t\t\t\tif(msg.indexOf('syntax error')!==-1) // WebSQL may not support truncate function\r\n\t\t\t\t\tscope.delete(tableName, [], successCallback, errorCallback);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tscope.insert = function(tableName, object, successCallback, errorCallback){\r\n\t\tvar objectName = [];\r\n\t\tvar objectName_ = [];\r\n\t\tvar objectData = [];\r\n\t\tvar object_ = JSON.parse(JSON.stringify(object)); // Object copy before preprocessData\r\n\t\tvar columns = Object.keys(object_);\r\n\t\tpreprocessData(tableName, 'set', object_);\r\n\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\tobjectName.push(validateText(columns[i]));\r\n\t\t\tobjectName_.push('?');\r\n\r\n\t\t\tobjectData.push(object_[columns[i]]);\r\n\t\t}\r\n\t\tvar query = \"INSERT INTO \" + validateText(tableName) + \" (\" + objectName.join(', ') + \") VALUES (\" + objectName_.join(', ') + \")\";\r\n\t\t\r\n\t\tscope.SQLQuery(query, objectData, successCallback, errorCallback);\r\n\t}\r\n\r\n\tscope.update = function(tableName, object, where, successCallback, errorCallback){\r\n\t\tvar wheres = scope.makeWhere(where);\r\n\t\tvar objectName = [];\r\n\t\tvar objectData = [];\r\n\t\tvar object_ = JSON.parse(JSON.stringify(object)); // Object copy before preprocessData\r\n\t\tvar columns = Object.keys(object_);\r\n\t\tpreprocessData(tableName, 'set', object_);\r\n\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\tobjectName.push(validateText(columns[i])+' = ?');\r\n\t\t\tobjectData.push(object_[columns[i]]);\r\n\t\t}\r\n\t\tvar query = \"UPDATE \" + validateText(tableName) + \" SET \" + objectName.join(', ') + wheres[0];\r\n\t\tscope.SQLQuery(query, objectData.concat(wheres[1]), successCallback, errorCallback);\r\n\t}\r\n\r\n\tscope.drop = function(tableName, successCallback, errorCallback){\r\n\t\tscope.SQLQuery(\"DROP TABLE \"+validateText(tableName), [], successCallback, errorCallback);\r\n\t}\r\n\r\n\tscope.closeDatabase = function(){\r\n\t\tif(scope.polyfill) return;\r\n\t\tscope.db.close(function(){\r\n\t\t\t// Success\r\n\t\t}, function(error){\r\n\t\t\tvar msg = \"Error closing Database:\" + error.message;\r\n\t\t\tif(errorCallback) errorCallback(msg);\r\n\t\t\telse console.error(msg);\r\n\t\t});\r\n\t}\r\n}","}\r\n\r\n// isNode\r\nif(typeof process !== 'undefined' && process.execPath)\r\n\tmodule.exports = SFDatabase;"]}