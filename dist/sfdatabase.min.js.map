{"version":3,"sources":["_head.js","IDB.js","WebSQL.js","SQL.js","_foot.js"],"names":["SFDatabase","databaseName","options","onConnected","scope","this","db","pending","initialized","debug","initFinish","setTimeout","resumePending","pendingTimer","clearTimeout","length","i","splice","destroyObject","obj","Array","objKeys","Object","keys","preprocessTable","preprocessData","tableName","mode","object","found","isNode","process","execPath","onStructureInitialize","checkStructure","callback","table","databaseStructure","queued","reduceQueue","console","error","createTable","IDBStructure","initError","IDBWhere","regexEscape","IDBLimit","prepareQuery","data","rules","ORCondition","currentCondition","rules_","matches","match","check","toLowerCase","rule","operationCondition","undefined","indexOf","likeCode","regexed","rule_","temp","slice","replace","push","exist","RegExp","join","query","processed","startFrom","limit","objectStore","where","LIMIT","ORDER","cursor","index","openCursor","key","columns","successCallback","errorCallback","objectStoreNames","contains","text","columns_","createObjectStore","keyPath","autoIncrement","col","createIndex","unique","e","insert","duplicated","objectStoreRequest","getObjectStore","add","onerror","onsuccess","ev","target","result","select","operation","value","event","code","continue","delete","update","drop","closeDatabase","deleteObjectStore","initializeTable","close","window","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","IDBTransaction","webkitIDBTransaction","msIDBTransaction","IDBKeyRange","webkitIDBKeyRange","msIDBKeyRange","storage","open","onupgradeneeded","versionchange","action","transaction","WebSQLStructure","validateText","makeWhere","comparator","children","wheres","objectData","defaultConditional","specialList","isNaN","msg","type","constructor","name","a","concat","likes","test","split","haveRelation","childs","stack","order","toUpperCase","where_","String","SQLQuery","select_","objectName","objectName_","object_","JSON","parse","stringify","polyfill","message","SQLQueryBuilder","values","tx","executeSql","res","readOnly","rows","rowsAffected","disablePlugin","sqlitePlugin","openDatabase","location","error_","websql","warn","module","exports"],"mappings":"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","file":"SFDatabase.min.js","sourcesContent":["/*\r\n\tScarletsFiction Database Library\r\n\tA simple database library for browser and nodejs\r\n\thttps://github.com/ScarletsFiction/SFDatabase-js\r\n\t\r\n\tMake sure you include this header on this script\r\n*/\r\n\r\n'use strict';\r\n\r\n// Ext-AlaSQL.js are required for browser only if the browser didn't support WebSQL\r\nfunction SFDatabase(databaseName, options, onConnected){\r\n\tvar scope = this;\r\n\tscope.db = null;\r\n\tscope.pending = [];\r\n\tscope.initialized = false;\r\n\tif(!options)\r\n\t\toptions = {debug:false};\r\n\r\n\tvar initFinish = function(){\r\n\t\tif(scope.initialized) return;\r\n\t\tscope.initialized = true;\r\n\r\n\t\tif(onConnected){\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tif(!onConnected(resumePending))\r\n\t\t\t\t\tresumePending();\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\telse resumePending();\r\n\t}\r\n\r\n\tvar pendingTimer = -1;\r\n\tvar resumePending = function(){\r\n\t\tif(!scope.db){\r\n\t\t\tclearTimeout(pendingTimer);\r\n\t\t\tpendingTimer = setTimeout(resumePending, 1000);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!scope.pending.length) return;\r\n\t\tfor (var i = 0; i < scope.pending.length; i++) {\r\n\t\t\tscope.pending[i]();\r\n\t\t}\r\n\t\tscope.pending.splice(0);\r\n\t}\r\n\r\n\tvar destroyObject = function(obj){\r\n\t\tif(!obj || typeof obj !== 'object') return;\r\n\t\tif(obj instanceof Array)\r\n\t\t\tobj.splice(0);\r\n\t\telse {\r\n\t\t\tvar objKeys = Object.keys(obj);\r\n\t\t\tfor (var i = 0; i < objKeys.length; i++) {\r\n\t\t\t\tdelete obj[objKeys[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t\tobj = null;\r\n\t}\r\n\r\n\tscope.preprocessTable = {}; // {tableName:{columnName:{set:function, get:function}}}}\r\n\tvar preprocessData = function(tableName, mode, object){\r\n\t\tvar found = false;\r\n\t\tif(!scope.preprocessTable[tableName]) return found;\r\n\r\n\t\tvar keys = Object.keys(scope.preprocessTable[tableName]);\r\n\t\tfor (var i = 0; i < keys.length; i++) {\r\n\t\t\tif(!object[keys[i]] || !scope.preprocessTable[tableName][keys[i]][mode])\r\n\t\t\t\tcontinue;\r\n\t\t\tobject[keys[i]] = scope.preprocessTable[tableName][keys[i]][mode](object[keys[i]]);\r\n\t\t\tfound = true;\r\n\t\t}\r\n\t\treturn found;\r\n\t}\r\n\r\n\tvar isNode = typeof process !== 'undefined' && process.execPath;\r\n\tif(!isNode){\r\n\t\tvar onStructureInitialize = null;\r\n\t\tvar checkStructure = function(callback){\r\n\t\t\tvar table = Object.keys(options.databaseStructure);\r\n\r\n\t\t\tvar queued = table.length;\r\n\t\t\tvar reduceQueue = function(){\r\n\t\t\t\tqueued--;\r\n\t\t\t\tif(queued === 0){\r\n\t\t\t\t\tif(!callback) initFinish(scope);\r\n\t\t\t\t\telse callback();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tif(queued > 1)\r\n\t\t\t\t\tconsole.error(\"Failed to initialize database structure\");\r\n\t\t\t}, 5000);\r\n\r\n\t\t\tfor (var i = 0; i < table.length; i++) {\r\n\t\t\t\tscope.createTable(table[i], options.databaseStructure[table[i]], reduceQueue);\r\n\t\t\t}\r\n\r\n\t\t\tif(onStructureInitialize){\r\n\t\t\t\tonStructureInitialize();\r\n\t\t\t\tonStructureInitialize = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// Load all query builder from here","if(!isNode && !options.websql){\r\n\tIDBStructure(function(){\r\n\t\t// Fallback to WebSQL\r\n\t\tconsole.warn(\"Fallback to WebSQL\");\r\n\t\tWebSQLStructure();\r\n\t});\r\n}\r\n\r\nfunction IDBStructure(initError){\r\n\tIDBQueryBuilder();\r\n\r\n\tif(!window.indexedDB)\r\n  \t\twindow.indexedDB = window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;\r\n\tif(!window.IDBTransaction)\r\n\t\twindow.IDBTransaction = window.webkitIDBTransaction || window.msIDBTransaction;\r\n\tif(!window.IDBKeyRange)\r\n\t\twindow.IDBKeyRange = window.webkitIDBKeyRange || window.msIDBKeyRange;\r\n\r\n\tif(!window.indexedDB || !window.IDBTransaction || !window.IDBKeyRange){\r\n\t\tif(initError) initError();\r\n\t\treturn;\r\n\t}\r\n\r\n\tscope.storage = 'indexeddb';\r\n\tscope.db = window.indexedDB.open(databaseName, 1);\r\n\tscope.db.onerror = initError;\r\n\r\n\tscope.db.onupgradeneeded = scope.db.versionchange = function(ev){\r\n\t\tif(scope.db.result)\r\n\t\t\tscope.db = scope.db.result;\r\n\r\n\t\tcheckStructure(function(){});\r\n\t};\r\n\r\n\tscope.db.onsuccess = function(ev){\r\n\t\tif(scope.db.result)\r\n\t\t\tscope.db = scope.db.result;\r\n\r\n\t\tcheckStructure(function(){\r\n\t\t\tinitFinish(scope);\r\n\t\t});\r\n\t};\r\n\r\n\t//action = readwrite, readonly\r\n\tscope.getObjectStore = function(tableName, action, errorCallback){\r\n  \t\tvar transaction = scope.db.transaction(tableName, action);\r\n  \t\ttransaction.onerror = errorCallback || console.error;\r\n  \t\treturn transaction.objectStore(tableName);\r\n\t}\r\n}","if(!isNode && options.websql === undefined) options.websql = true;\r\nif(options.websql){\r\n\tWebSQLStructure(function(){\r\n\t\t// Fallback to IndexedDB\r\n\t\tconsole.warn(\"Fallback to IndexedDB\");\r\n\t\tIDBStructure();\r\n\t});\r\n}\r\n\r\nfunction WebSQLStructure(initError){\r\n\tSQLQueryBuilder();\r\n\r\n\tscope.SQLQuery = function(query, values, successCallback, errorCallback){\r\n\t\tif(options.debug) options.debug(query, values);\r\n\r\n\t\tscope.db.transaction(function(tx){\r\n\t\t\ttx.executeSql(query, values, function(tx, res){\r\n\t\t\t\tdestroyObject(values);\r\n\t            values = query = null;\r\n\r\n\t\t\t\tif(successCallback){\r\n\t\t\t\t\tvar readOnly = res && res.rows ? res.rows : res; // SQLResultSetRowList is immutable\r\n\t\t\t\t\tif(res && res.rowsAffected && !readOnly.length){\r\n\t\t\t\t\t\tsuccessCallback(res.rowsAffected);\r\n\t\t\t\t\t\treadOnly = null;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(readOnly.length){\r\n\t\t\t\t\t\tvar result = {length:readOnly.length};\r\n\t\t\t\t\t\tfor (var i = 0; i < readOnly.length; i++) {\r\n\t\t\t\t\t\t\tresult[i] = readOnly[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treadOnly = null;\r\n\t\t\t\t\t\tsuccessCallback(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse successCallback([]);\r\n\t            }\r\n\t\t\t}, function(tx, error){\r\n\t\t\t\tvar msg = 'Database Error: ' + error.message;\r\n\t\t\t\tdestroyObject(values);\r\n\t            values = query = null;\r\n\r\n\t\t\t\tif(errorCallback) errorCallback(msg);\r\n\t\t\t\telse console.error(msg);\r\n\t\t\t});\r\n\t\t}, function(error){\r\n\t\t\tvar msg = 'Database Transaction Error: ' + error.message;\r\n\t\t\tif(errorCallback) errorCallback(msg);\r\n\t\t\telse console.error(msg);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initializeTable(disablePlugin){\r\n\t\tif(!disablePlugin && window.sqlitePlugin){\r\n\t\t\tscope.db = window.sqlitePlugin.openDatabase({name: databaseName, location: 'default'}, checkStructure, function(){\r\n\t\t\t\tconsole.error_(\"Failed to initialize sqlitePlugin\");\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tinitializeTable(true);\r\n\t\t\t\t}, 500);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if(window.openDatabase){\r\n\t\t\tscope.db = window.openDatabase(databaseName, \"1.0\", databaseName, 1024);\r\n\t\t\tif(scope.db) setTimeout(checkStructure, 500);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tconsole.error('WebSQL is not supported on this browser');\r\n\t\t\tif(initError) initError();\r\n\t\t}\r\n\t}\r\n\r\n\tinitializeTable();\r\n}","function SQLQueryBuilder(){\r\n\t// structure must have `scope.SQLQuery`\r\n\r\n\tfunction validateText(text){\r\n\t\tvar matches = text.match(/[a-zA-Z0-9_\\.]+/i);\r\n\t\treturn '`'+matches[0]+'`';\r\n\t}\r\n\r\n\t//{('AND', 'OR'), 'ORDER':{columnName:'ASC', 'DESC'}, 'LIMIT':[startIndex, rowsLimit]}\r\n\r\n\t// ex: [\"AND\"=>[\"id\"=>12, \"OR\"=>[\"name#1\"=>\"myself\", \"name\"=>\"himself\"]], \"LIMIT\"=>1]\r\n\t\t// Select one where (id == 12 && (name == \"myself\" || name == \"himself\"))\r\n\tscope.makeWhere = function(object, comparator, children){\r\n\t\tif(!object) return ['', []];\r\n\t\tvar wheres = [];\r\n\r\n\t\tvar objectData = [];\r\n\t\tvar columns = Object.keys(object);\r\n\t\tvar defaultConditional = ' AND ';\r\n\t\tvar specialList = ['order', 'limit'];\r\n\r\n\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\tvar value = object[columns[i]];\r\n\r\n\t\t\tvar matches = columns[i].match(/([a-zA-Z0-9_\\.]+)(\\[(\\>\\=?|\\<\\=?|\\!|\\<\\>|\\>\\<|\\!?~)\\])?/);\r\n\t\t\tvar check = matches[1].toLowerCase();\r\n\t\t\tif(check==='and' || check==='or') continue;\r\n\t\t\tif(!children && specialList.indexOf(check)!==-1) continue;\r\n\r\n\t\t\tif(matches[3]){\r\n\t\t\t\tif((['>', '>=', '<', '<=']).indexOf(matches[3])!==-1)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(!isNaN(value))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twheres.push(matches[1] + ' ' + matches[3] + ' ?');\r\n\t\t\t\t\t\tobjectData.push(value);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvar msg = 'SQL where: value of ' + matches[1] + ' is non-numeric and can\\'t be accepted';\r\n\t\t\t\t\t\tconsole.error(msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(matches[3] === '!')\r\n\t\t\t\t{\r\n\t\t\t\t\tvar type = value===null || value===undefined ? false : value.constructor.name;\r\n\t\t\t\t\tif(!type)\r\n\t\t\t\t\t\twheres.push(matches[1] + ' IS NOT NULL');\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(type==='Array'){\r\n\t\t\t\t\t\t\tvar temp = [];\r\n\t\t\t\t\t\t\tfor (var a = 0; a < value.length; a++) {\r\n\t\t\t\t\t\t\t\ttemp.push('?');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twheres.push(matches[1] + ' NOT IN ('+ temp.join(', ') +')');\r\n\t\t\t\t\t\t\tobjectData = objectData.concat(value);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\telse if(type==='Number' || type==='Boolean' || type==='String'){\r\n\t\t\t\t\t\t\twheres.push(matches[1] + ' != ?');\r\n\t\t\t\t\t\t\tobjectData.push(value);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tconsole.error('SQL where: value ' + matches[1] + ' with type ' + type + ' can\\'t be accepted');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (matches[3] === '~' || matches[3] === '!~')\r\n\t\t\t\t{\r\n\t\t\t\t\tif(value.constructor !== Array){\r\n\t\t\t\t\t\tvalue = [value];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar likes = [];\r\n\t\t\t\t\tfor (var a = 0; a < value.length; a++) {\r\n\t\t\t\t\t\tlikes.push(matches[1] + (matches[3] === '!~' ? ' NOT' : '') + ' LIKE ?');\r\n\t\t\t\t\t\tif(value.indexOf('%') === -1) value[a] = '%'+value[a]+'%';\r\n\t\t\t\t\t\tobjectData.push(value[a]);\r\n\t\t\t\t\t}\r\n\r\n                    wheres.push('('+likes.join(' OR ')+')');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar type = value===null || value===undefined ? false : value.constructor.name;\r\n\t\t\t\tif(!type)\r\n\t\t\t\t\twheres.push(matches[1] + ' IS NULL');\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(type==='Array'){\r\n\t\t\t\t\t\tvar temp = [];\r\n\t\t\t\t\t\tfor (var a = 0; a < value.length; a++) {\r\n\t\t\t\t\t\t\ttemp.push('?');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twheres.push(matches[1] + ' IN ('+ temp.join(', ') +')');\r\n\t\t\t\t\t\tobjectData = objectData.concat(value);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse if(type==='Number' || type==='Boolean' || type==='String'){\r\n\t\t\t\t\t\twheres.push(matches[1] + ' = ?');\r\n\t\t\t\t\t\tobjectData.push(value);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tconsole.error('SQL where: value ' + matches[1] + ' with type ' + type + ' can\\'t be accepted');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tif(columns[i]==='ORDER'||columns[i]==='LIMIT')\r\n                continue;\r\n\r\n\t\t\tvar test = columns[i].split('AND');\r\n\t\t\tvar haveRelation = false;\r\n\t\t\tif(test.length === 2 && test[0] === ''){\r\n\t\t\t\tdefaultConditional = ' AND ';\r\n\t\t\t\thaveRelation = true;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttest = columns[i].split('OR');\r\n\t\t\t\tif(test.length === 2 && test[0] === ''){\r\n\t\t\t\t\tdefaultConditional = ' OR ';\r\n\t\t\t\t\thaveRelation = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(haveRelation){\r\n\t\t\t\tvar childs = scope.makeWhere(object[columns[i]], defaultConditional, true);\r\n\t\t\t\twheres.push('('+childs[0]+')');\r\n\t\t\t\tobjectData = objectData.concat(childs[1]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar options = '';\r\n\t\tif(object['ORDER']){\r\n\t\t\tvar columns = Object.keys(object['ORDER']);\r\n\t\t\tvar stack = [];\r\n\t\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\t\tvar order = object['ORDER'][columns[i]].toUpperCase();\r\n\t\t\t\tif(order !== 'ASC' && order !== 'DESC') continue;\r\n\t\t\t\tstack.push(validateText(columns[i]) + ' ' + order);\r\n\t\t\t}\r\n\t\t\toptions = options + ' ORDER BY ' + stack.join(', ');\r\n\t\t}\r\n\t\tif(object['LIMIT']){\r\n\t\t\tif(!isNaN(object['LIMIT'][0]) && !isNaN(object['LIMIT'][1])){\r\n\t\t\t\toptions = options + ' LIMIT ' + object['LIMIT'][1] + ' OFFSET ' + object['LIMIT'][0];\r\n\t\t\t}\r\n\t\t\telse if(!isNaN(object['LIMIT'])){\r\n\t\t\t\toptions = options + ' LIMIT '+ object['LIMIT'];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar where_ = '';\r\n\t\tif(wheres.length!==0){\r\n\t\t\tif(!children)\r\n\t\t\t\twhere_ = \" WHERE \";\r\n\t\t\twhere_ = where_ + wheres.join(comparator ? comparator : defaultConditional);\r\n\t\t}\r\n\r\n\t\treturn [where_ + options, objectData];\r\n\t}\r\n\r\n\tscope.createTable = function(tableName, columns, successCallback, errorCallback)\r\n\t{\r\n\t\tvar columns_ = Object.keys(columns);\r\n\t\tfor(var i = 0; i < columns_.length; i++){\r\n\t\t\tif(columns[columns_[i]].constructor.name === 'Array')\r\n\t\t\t\tcolumns_[i] = validateText(columns_[i]) + ' ' + columns[columns_[i]].join(' ').toUpperCase();\r\n\t\t\telse\r\n\t\t\t\tcolumns_[i] = validateText(columns_[i]) + ' ' + String(columns[columns_[i]]).toUpperCase();\r\n\t\t}\r\n\t\tvar query = 'CREATE TABLE IF NOT EXISTS '+validateText(tableName)+' ('+columns_.join(', ')+')';\r\n\r\n\t\tscope.SQLQuery(query, [], successCallback, errorCallback);\r\n\t}\r\n\r\n\t//Select separated by comma\r\n\tscope.select = function(tableName, select, where, successCallback, errorCallback){\r\n\t\tvar select_ = select;\r\n\t\tif(select!=='*')\r\n\t\t\tfor(var i = 0; i < select_.length; i++){\r\n\t\t\t\tselect_[i] = validateText(select_[i]);\r\n\t\t\t}\r\n\t\telse select_ = false;\r\n\t\t\r\n\t\tvar wheres = scope.makeWhere(where);\r\n\t\tvar query = \"SELECT \" + (select_?select_.join(', '):select) + \" FROM \" + validateText(tableName) + wheres[0];\r\n\r\n\t\tscope.SQLQuery(query, wheres[1], function(data){\r\n\t\t\tif(!successCallback) return;\r\n\t\t\tif(data.length!==0 && preprocessData(tableName, 'get', data[0])){\r\n\t\t\t\tfor (var i = 1; i < data.length; i++) {\r\n\t\t\t\t\tpreprocessData(tableName, 'get', data[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsuccessCallback(data);\r\n\t\t}, errorCallback);\r\n\t}\r\n\r\n\tscope.delete = function(tableName, where, successCallback, errorCallback){\r\n\t\tif(where){\r\n\t\t\tvar wheres = scope.makeWhere(where);\r\n\t\t\tvar query = \"DELETE FROM \" + validateText(tableName) + wheres[0];\r\n\t\t\tscope.SQLQuery(query, wheres[1], successCallback, errorCallback);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar query = \"TRUNCATE TABLE \" + validateText(tableName);\r\n\t\t\tscope.SQLQuery(query, [], successCallback, function(msg){\r\n\t\t\t\tif(msg.indexOf('syntax error')!==-1) // WebSQL may not support truncate function\r\n\t\t\t\t\tscope.delete(tableName, [], successCallback, errorCallback);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tscope.insert = function(tableName, object, successCallback, errorCallback){\r\n\t\tvar objectName = [];\r\n\t\tvar objectName_ = [];\r\n\t\tvar objectData = [];\r\n\t\tvar object_ = JSON.parse(JSON.stringify(object)); // Object copy before preprocessData\r\n\t\tvar columns = Object.keys(object_);\r\n\t\tpreprocessData(tableName, 'set', object_);\r\n\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\tobjectName.push(validateText(columns[i]));\r\n\t\t\tobjectName_.push('?');\r\n\r\n\t\t\tobjectData.push(object_[columns[i]]);\r\n\t\t}\r\n\t\tvar query = \"INSERT INTO \" + validateText(tableName) + \" (\" + objectName.join(', ') + \") VALUES (\" + objectName_.join(', ') + \")\";\r\n\t\t\r\n\t\tscope.SQLQuery(query, objectData, successCallback, errorCallback);\r\n\t}\r\n\r\n\tscope.update = function(tableName, object, where, successCallback, errorCallback){\r\n\t\tvar wheres = scope.makeWhere(where);\r\n\t\tvar objectName = [];\r\n\t\tvar objectData = [];\r\n\t\tvar object_ = JSON.parse(JSON.stringify(object)); // Object copy before preprocessData\r\n\t\tvar columns = Object.keys(object_);\r\n\t\tpreprocessData(tableName, 'set', object_);\r\n\t\tfor(var i = 0; i < columns.length; i++){\r\n\t\t\tobjectName.push(validateText(columns[i])+' = ?');\r\n\t\t\tobjectData.push(object_[columns[i]]);\r\n\t\t}\r\n\t\tvar query = \"UPDATE \" + validateText(tableName) + \" SET \" + objectName.join(', ') + wheres[0];\r\n\t\tscope.SQLQuery(query, objectData.concat(wheres[1]), successCallback, errorCallback);\r\n\t}\r\n\r\n\tscope.drop = function(tableName, successCallback, errorCallback){\r\n\t\tscope.SQLQuery(\"DROP TABLE \"+validateText(tableName), [], successCallback, errorCallback);\r\n\t}\r\n\r\n\tscope.closeDatabase = function(){\r\n\t\tif(scope.polyfill) return;\r\n\t\tscope.db.close(function(){\r\n\t\t\t// Success\r\n\t\t}, function(error){\r\n\t\t\tvar msg = \"Error closing Database:\" + error.message;\r\n\t\t\tif(errorCallback) errorCallback(msg);\r\n\t\t\telse console.error(msg);\r\n\t\t});\r\n\t}\r\n}","}\r\n\r\n// isNode\r\nif(typeof process !== 'undefined' && process.execPath)\r\n\tmodule.exports = SFDatabase;"]}